# EdgeOne whoami Docker build pipeline 
# Example: germanedge-docker/whoami:1.0
# dockerRegistry: "artifactory.new-solutions.com" -> image container registry service

name: "e1-whoami_$(Date:yyyyMMdd)$(Rev:.r)"

variables:
  dockerId: "edge-one"  # Docker-ID for container registry service
  imageName: "whoami"  # name of the image 

trigger:
- master

pr: none

jobs:
# - job: 'CreateDockerWhoami_Windows2016'
#   displayName: 'creates a whoami Docker for Windows 2016'
#   pool: 
#     name: 'AWS'
#   steps:
#   - task: Docker@2
#     displayName: 'Build and Push the image'
#     inputs:
#       containerRegistry: 'germanedge-docker.artifactory'
#       repository: '$(dockerId)/$(imageName)'
#       command: 'buildAndPush'
#       Dockerfile: 'Dockerfile.windows'
#       buildContext: '.'
#       tags: 'latest'
#         # $(Build.BuildId)'
- job: 'DockerLinux'
  displayName: 'creates a whoami Docker for Linux'
  pool:
    name: 'Hosted Ubuntu 1604'
  steps:
  - task: Docker@2
    displayName: 'Build and Push the image'
    inputs:
      containerRegistry: 'germanedge-docker.artifactory'
      repository: '$(dockerId)/$(imageName)'
      command: 'buildAndPush'
      Dockerfile: 'linux/Dockerfile'
      buildContext: '.'
      tags: |
        $(Build.BuildId)
        master
        latest
